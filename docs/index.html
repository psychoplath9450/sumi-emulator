<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SumiBoy Flasher</title>
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
    <style>
        :root {
            --white: #ffffff;
            --black: #1a1a1a;
            --gray: #dddddd;
            --gray-dark: #888888;
            --gray-light: #f2f0ed;
            --red: #c8352c;
            --red-light: #e8443a;
            --red-dark: #a02a22;
            --desktop: #f5f3f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Geneva', 'Helvetica Neue', Helvetica, sans-serif;
            font-size: 13px;
            background: var(--desktop);
            min-height: 100vh;
            color: var(--black);
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-top: 20px;
        }
        .header canvas { display: block; margin: 0 auto 16px; }
        .header h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 2px; }
        .header h1 span { color: var(--red); }
        .header .tagline { font-size: 11px; color: var(--gray-dark); letter-spacing: 2px; text-transform: uppercase; }

        .window {
            max-width: 520px; margin: 0 auto 20px;
            background: var(--white); border: 1px solid #c0c0c0; border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
        }
        .title-bar {
            background: linear-gradient(180deg, #fafafa, #e8e8e8);
            border-bottom: 1px solid #c0c0c0; padding: 8px 14px;
            display: flex; align-items: center; gap: 8px; border-radius: 10px 10px 0 0;
        }
        .window-dots { display: flex; gap: 6px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.12); }
        .dot-red { background: #ff5f57; } .dot-yellow { background: #febc2e; } .dot-green { background: #28c840; }
        .title-bar h2 { flex: 1; text-align: center; font-size: 13px; font-weight: 600; color: #444; }
        .title-bar .spacer { width: 54px; }
        .window-body { padding: 20px; }

        .steps { font-size: 12px; color: #555; margin-bottom: 16px; }
        .steps ol { margin-left: 20px; }
        .steps li { margin-bottom: 6px; }

        esp-web-install-button { display: block; margin: 16px 0; }
        esp-web-install-button::part(button) {
            background: linear-gradient(180deg, var(--red-light), var(--red));
            border: 1px solid var(--red-dark); border-radius: 6px;
            padding: 14px 20px; font-family: inherit; font-size: 14px; font-weight: 600;
            color: white; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            width: 100%; transition: all 0.15s;
        }
        esp-web-install-button::part(button):hover {
            background: linear-gradient(180deg, #ee4e44, var(--red-light));
            box-shadow: 0 2px 8px rgba(200,53,44,0.3);
        }

        .note {
            background: #fef9e7; border: 1px solid #e6c84e; border-radius: 4px;
            padding: 10px 12px; font-size: 11px; line-height: 1.5; margin-top: 12px;
        }
        .note strong { color: #b8860b; }

        .browser-warning { background: #fff0f0; border: 1px solid #cc3333; border-radius: 6px; padding: 12px; text-align: center; margin-bottom: 14px; display: none; }
        .browser-warning h3 { color: #cc3333; font-size: 12px; margin-bottom: 4px; }

        .features-bar { max-width: 520px; margin: 0 auto 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .feat-card { background: var(--white); border: 1px solid #e0e0e0; border-radius: 8px; padding: 14px 10px; text-align: center; }
        .feat-card .icon { font-size: 18px; margin-bottom: 4px; }
        .feat-card .label { font-size: 10px; font-weight: 600; color: #555; letter-spacing: 0.5px; }

        .controls-grid { display: grid; grid-template-columns: auto 1fr; gap: 4px 12px; font-size: 11px; }
        .ctrl-key { color: var(--red); font-weight: 600; }
        .ctrl-val { color: #666; }

        footer { max-width: 520px; margin: 0 auto; text-align: center; padding: 16px; font-size: 10px; color: var(--gray-dark); }

        @media (max-width: 540px) { body { padding: 12px; } .features-bar { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="header">
        <canvas id="pokeball" width="240" height="240"></canvas>
        <h1>Sumi<span>Boy</span></h1>
        <div class="tagline">E-Ink Game Boy for the Xteink X4</div>
    </div>

    <div class="window">
        <div class="title-bar">
            <div class="window-dots"><div class="dot dot-red"></div><div class="dot dot-yellow"></div><div class="dot dot-green"></div></div>
            <h2>Flash Firmware</h2>
            <div class="spacer"></div>
        </div>
        <div class="window-body">
            <div id="browserWarning" class="browser-warning">
                <h3>Unsupported Browser</h3>
                <p>Web Serial requires <strong>Chrome</strong>, <strong>Edge</strong>, or <strong>Opera</strong>.</p>
            </div>

            <div class="steps"><ol>
                <li>Connect your SUMI via USB-C</li>
                <li>Click <strong>Install</strong> below</li>
                <li>Select the USB serial port when prompted</li>
            </ol></div>

            <esp-web-install-button manifest="manifest.json">
                <button slot="activate">Install SumiBoy</button>
                <span slot="unsupported">Your browser doesn't support Web Serial</span>
                <span slot="not-allowed">Not allowed to use Web Serial</span>
            </esp-web-install-button>

            <div class="note">
                <strong>Note:</strong> This replaces your current firmware. To go back to stock, re-flash the original SUMI firmware.
            </div>
        </div>
    </div>

    <div class="features-bar">
        <div class="feat-card"><div class="icon">ðŸŽ®</div><div class="label">Full GB CPU</div></div>
        <div class="feat-card"><div class="icon">ðŸ’¾</div><div class="label">Save States</div></div>
        <div class="feat-card"><div class="icon">ðŸ˜´</div><div class="label">Deep Sleep</div></div>
    </div>

    <div class="window" style="margin-bottom: 20px;">
        <div class="title-bar">
            <div class="window-dots"><div class="dot dot-red"></div><div class="dot dot-yellow"></div><div class="dot dot-green"></div></div>
            <h2>Controls</h2>
            <div class="spacer"></div>
        </div>
        <div class="window-body">
            <div class="controls-grid">
                <span class="ctrl-key">D-Pad</span><span class="ctrl-val">Movement</span>
                <span class="ctrl-key">A (Confirm)</span><span class="ctrl-val">Select / interact</span>
                <span class="ctrl-key">B (Back)</span><span class="ctrl-val">Cancel / run</span>
                <span class="ctrl-key">PWR tap</span><span class="ctrl-val">Full screen refresh</span>
                <span class="ctrl-key">PWR hold ~2s</span><span class="ctrl-val">Save + open in-game menu</span>
                <span class="ctrl-key">PWR hold ~3s</span><span class="ctrl-val">Save + deep sleep</span>
                <span class="ctrl-key">PWR (asleep)</span><span class="ctrl-val">Wake up</span>
            </div>
        </div>
    </div>

    <footer>SumiBoy Â· A SUMI Community Project</footer>

    <script>
    (function(){
        if (!('serial' in navigator)) document.getElementById('browserWarning').style.display = 'block';

        const c = document.getElementById('pokeball');
        const ctx = c.getContext('2d');
        const W=240, H=240, cx=W/2, cy=H/2, R=90;

        function rng(seed){let s=seed;return function(){s=(s*16807)%2147483647;return(s-1)/2147483646;};}

        const rs0=rng(77);
        let placed=0;
        while(placed<300){
            const a=rs0()*Math.PI;
            const dist=Math.sqrt(rs0())*(R-8);
            const px=cx+Math.cos(a+Math.PI)*dist;
            const py=cy-Math.sin(a)*dist;
            const dx=px-cx,dy=py-cy;
            if(Math.sqrt(dx*dx+dy*dy)<17)continue;
            if(py>=cy-2)continue;
            const sz=rs0()<0.85?(0.3+rs0()*0.5):(0.6+rs0()*0.8);
            ctx.fillStyle=`rgba(80,80,80,${0.3+rs0()*0.5})`;
            ctx.beginPath();ctx.arc(px,py,sz,0,Math.PI*2);ctx.fill();
            placed++;
        }

        ctx.fillStyle='#1a1a1a';
        const rm=rng(100);
        for(let i=0;i<200;i++){
            const a=rm()*Math.PI*2, d=R+4+Math.pow(rm(),.5)*35, sz=.3+rm();
            const py=cy+Math.sin(a)*d;
            if(Math.abs(py-cy)<5) continue;
            ctx.fillStyle=`rgba(80,80,80,${.1+rm()*.25})`;
            ctx.beginPath();ctx.arc(cx+Math.cos(a)*d,py,sz,0,Math.PI*2);ctx.fill();
        }

        ctx.fillStyle='#1a1a1a';
        const rb=rng(201), startA=-.5, gap=.55, endA=startA+Math.PI*2-gap, maxT=7;
        for(let a=startA;a<endA;a+=.005){
            const p=(a-startA)/(endA-startA);
            const r=R+Math.sin(a*2.3+201)*2.5+Math.cos(a*5.1+201)*2+rb()*1.2;
            let t;if(p<.06)t=maxT*(p/.06)*.5;else if(p>.88)t=maxT*((1-p)/.12);else t=maxT+Math.sin(a*1.3+201)*1.2;
            if(t<.3)t=.3;
            const bx=cx+Math.cos(a)*r,by=cy+Math.sin(a)*r;
            ctx.beginPath();ctx.arc(bx,by,t/2,0,Math.PI*2);ctx.fill();
            if(t>2&&rb()>.82){const ea=a+Math.PI/2+(rb()-.5)*.5,ed=t/2+rb()*1.5;ctx.beginPath();ctx.arc(bx+Math.cos(ea)*ed,by+Math.sin(ea)*ed,.2+rb()*.7,0,Math.PI*2);ctx.fill();}
        }

        const rs=rng(202);
        for(let x=cx-R*.9;x<cx+R*.9;x++){
            const p=(x-(cx-R*.9))/(R*1.8);let t=3.5;
            if(p<.04)t*=p/.04;if(p>.96)t*=(1-p)/.04;
            t+=Math.sin(x*.06+202)*.7;const yo=Math.sin(x*.012+202);
            if(t>.3)ctx.fillRect(x,cy+yo-t/2,1,Math.max(1,Math.round(t)));
        }

        ctx.fillStyle='#f5f3f0';
        ctx.beginPath();ctx.arc(cx,cy,16,0,Math.PI*2);ctx.fill();
        ctx.fillStyle='#1a1a1a';
        for(let a=0;a<Math.PI*2;a+=.015){const r=14+Math.sin(a*5)*.3;ctx.beginPath();ctx.arc(cx+Math.cos(a)*r,cy+Math.sin(a)*r,1.2,0,Math.PI*2);ctx.fill();}
        for(let a=0;a<Math.PI*2;a+=.02){const r=7.5+Math.sin(a*3)*.2;ctx.beginPath();ctx.arc(cx+Math.cos(a)*r,cy+Math.sin(a)*r,.7,0,Math.PI*2);ctx.fill();}
        ctx.beginPath();ctx.arc(cx,cy,2.5,0,Math.PI*2);ctx.fill();
    })();
    </script>
</body>
</html>
